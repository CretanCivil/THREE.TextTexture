(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b(require("three")):"function"==typeof define&&define.amd?define(["three"],b):(a.THREE=a.THREE||{},a.THREE.TextTexture=b(a.THREE))})(this,function(a){"use strict";function b(){return document.createElement("canvas")}function c(a){return a===void 0}function d(a,b,c,d,e){return[a,b,c,d+"px",e].join(" ")}function e(a){return a?a.split("\n"):[]}function f(a){return a.reduce(function(a,b){return Math.max(a,b)})}function g(a,c){if(a.length){var d=b().getContext("2d");return d.font=c,f(a.map(function(a){return d.measureText(a).width}))}return 0}var h=function(f){function h(c){void 0===c&&(c={});var d=c.anisotropy,e=c.autoRedraw;void 0===e&&(e=!0);var g=c.fillStyle;void 0===g&&(g="white");var h=c.fontFamily;void 0===h&&(h="sans-serif");var i=c.fontSize;void 0===i&&(i=16);var j=c.fontStyle;void 0===j&&(j="normal");var k=c.fontVariant;void 0===k&&(k="normal");var l=c.fontWeight;void 0===l&&(l="normal");var m=c.format,n=c.lineWidth;void 0===n&&(n=0);var o=c.magFilter;void 0===o&&(o=a.LinearFilter);var p=c.mapping,q=c.minFilter;void 0===q&&(q=a.LinearFilter);var r=c.padding;void 0===r&&(r=.25);var s=c.strokeStyle;void 0===s&&(s="black");var t=c.text;void 0===t&&(t="");var u=c.textAlign;void 0===u&&(u="center");var v=c.textLineHeight;void 0===v&&(v=1.15);var w=c.type,x=c.wrapS,y=c.wrapT;f.call(this,b(),p,x,y,o,q,m,w,d),this.autoRedraw=e,this._text=t,this._textAlign=u,this._textLineHeight=v,this._fontFamily=h,this._fontSize=i,this._fontWeight=l,this._fontVariant=k,this._fontStyle=j,this._fillStyle=g,this._lineWidth=n,this._strokeStyle=s,this._padding=r,this.redraw()}f&&(h.__proto__=f),h.prototype=Object.create(f&&f.prototype),h.prototype.constructor=h;var i={text:{configurable:!0},textAlign:{configurable:!0},textLines:{configurable:!0},textLineHeight:{configurable:!0},textLineHeightInPixels:{configurable:!0},fontFamily:{configurable:!0},fontSize:{configurable:!0},fontWeight:{configurable:!0},fontVariant:{configurable:!0},fontStyle:{configurable:!0},font:{configurable:!0},fillStyle:{configurable:!0},lineWidth:{configurable:!0},lineWidthInPixels:{configurable:!0},strokeStyle:{configurable:!0},textWidthInPixels:{configurable:!0},textHeight:{configurable:!0},textHeightInPixels:{configurable:!0},padding:{configurable:!0},paddingInPixels:{configurable:!0},imageWidthInPixels:{configurable:!0},imageHeight:{configurable:!0},imageHeightInPixels:{configurable:!0},imageAspect:{configurable:!0}};return h.prototype.redraw=function(){var a=this,b=this.image.getContext("2d");if(b.clearRect(0,0,b.canvas.width,b.canvas.height),this.textWidthInPixels&&this.textHeightInPixels){b.canvas.width=this.imageWidthInPixels,b.canvas.height=this.imageHeightInPixels,b.font=this.font,b.textBaseline="middle";var c;switch(this.textAlign){case"left":b.textAlign="left",c=this.paddingInPixels+this.lineWidthInPixels/2;break;case"right":b.textAlign="right",c=this.paddingInPixels+this.lineWidthInPixels/2+this.textWidthInPixels;break;case"center":b.textAlign="center",c=this.paddingInPixels+this.lineWidthInPixels/4+this.textWidthInPixels/2;}var d=this.paddingInPixels+this.lineWidthInPixels/2+this.fontSize/2;b.fillStyle=this.fillStyle,b.miterLimit=1,b.lineWidth=this.lineWidthInPixels,b.strokeStyle=this.strokeStyle,this.textLines.forEach(function(e){a.lineWidth&&b.strokeText(e,c,d),b.fillText(e,c,d),d+=a.textLineHeightInPixels})}else b.canvas.width=b.canvas.height=1;this.needsUpdate=!0},h.prototype._redrawIfAuto=function(){this.autoRedraw&&this.redraw()},i.text.get=function(){return this._text},i.text.set=function(a){this._text!==a&&(this._text=a,this._textLines=void 0,this._textWidthInPixels=void 0,this._redrawIfAuto())},i.textAlign.get=function(){return this._textAlign},i.textAlign.set=function(a){this._textAlign!==a&&(this._textAlign=a,this._redrawIfAuto())},i.textLines.get=function(){return c(this._textLines)&&(this._textLines=e(this.text)),this._textLines},i.textLineHeight.get=function(){return this._textLineHeight},i.textLineHeight.set=function(a){this._textLineHeight!==a&&(this._textLineHeight=a,this._redrawIfAuto())},i.textLineHeightInPixels.get=function(){return this.fontSize*this.textLineHeight},i.fontFamily.get=function(){return this._fontFamily},i.fontFamily.set=function(a){this._fontFamily!==a&&(this._fontFamily=a,this._textWidthInPixels=void 0,this._redrawIfAuto())},i.fontSize.get=function(){return this._fontSize},i.fontSize.set=function(a){this._fontSize!==a&&(this._fontSize=a,this._textWidthInPixels=void 0,this._redrawIfAuto())},i.fontWeight.get=function(){return this._fontWeight},i.fontWeight.set=function(a){this._fontWeight!==a&&(this._fontWeight=a,this._textWidthInPixels=void 0,this._redrawIfAuto())},i.fontVariant.get=function(){return this._fontVariant},i.fontVariant.set=function(a){this._fontVariant!==a&&(this._fontVariant=a,this._textWidthInPixels=void 0,this._redrawIfAuto())},i.fontStyle.get=function(){return this._fontStyle},i.fontStyle.set=function(a){this._fontStyle!==a&&(this._fontStyle=a,this._textWidthInPixels=void 0,this._redrawIfAuto())},i.font.get=function(){return d(this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily)},i.fillStyle.get=function(){return this._fillStyle},i.fillStyle.set=function(a){this._fillStyle!==a&&(this._fillStyle=a,this._redrawIfAuto())},i.lineWidth.get=function(){return this._lineWidth},i.lineWidth.set=function(a){this._lineWidth!==a&&(this._lineWidth=a,this._redrawIfAuto())},i.lineWidthInPixels.get=function(){return this._lineWidth*this.fontSize},i.strokeStyle.get=function(){return this._strokeStyle},i.strokeStyle.set=function(a){this._strokeStyle!==a&&(this._strokeStyle=a,this._redrawIfAuto())},i.textWidthInPixels.get=function(){return c(this._textWidthInPixels)&&(this._textWidthInPixels=g(this.textLines,this.font)),this._textWidthInPixels},i.textHeight.get=function(){return this.textLineHeight*(this.textLines.length-1)+1},i.textHeightInPixels.get=function(){return this.textHeight*this.fontSize},i.padding.get=function(){return this._padding},i.padding.set=function(a){this._padding!==a&&(this._padding=a,this._redrawIfAuto())},i.paddingInPixels.get=function(){return this.padding*this.fontSize},i.imageWidthInPixels.get=function(){return this.textWidthInPixels+this.lineWidthInPixels+2*this.paddingInPixels},i.imageHeight.get=function(){return this.textHeight+this.lineWidth+2*this.padding},i.imageHeightInPixels.get=function(){return this.imageHeight*this.fontSize},i.imageAspect.get=function(){return this.image.width&&this.image.height?this.image.width/this.image.height:1},Object.defineProperties(h.prototype,i),h}(a.Texture);return h});
